import React from "react";
import { Button, TextField, Dialog, DialogActions, DialogContent, DialogContentText, DialogTitle } from "@material-ui/core";
import Select from 'react-select';
import axios from "axios";

const Checkbox = props => <input type="checkbox" {...props} />;

class SingleSelect extends React.Component {

  render() {
    const {isLoading, options, onChange} = this.props;
    return (
      <>
        <Select
          isLoading={isLoading}
          onChange={onChange}
          defaultValue={-1}
          isClearable
          isSearchable
          name="student"
          menuPosition="fixed"
          options={options}
        />
      </>
    );
  }
}


export class StudentPicker extends React.Component {
  state = {
    open: false,
    options: [],
    isLoading: false,
    value: -1,
  };

  handleClickOpen = async () => {
    this.setState({ open: true, isLoading: true });
    const data = await axios.get("http://localhost:3030/api/v1/course/get?visible=true");
    this.setState({isLoading: false, options: this.compute(data.data)});
  };

  compute = arr => {
    return arr.map(x => ({value: x.id, label: `${x.id} ${x.name}`}));
  }

  handleClose = () => {
    this.setState({ open: false });
  };

  handleSelect = () => {
    const { value } = this.state;
    if(value === -1) {
      alert("Select Student");
      return;
    }
    this.setState({ open: false, value: -1 });
    this.props.onClose(value);
  };

  handleChange = (e) => this.setState({value: (e ? e.value : -1)})

  render() {
    const Opener = this.props.component;
    return (
      <>
        <Opener onClick={this.handleClickOpen}/>
        <Dialog
          open={this.state.open}
          onClose={this.handleClose}
          aria-labelledby="form-dialog-title"
          PaperProps={{style:{overflow: "visible"}}} >
          <DialogTitle id="form-dialog-title">Student</DialogTitle>
          <DialogContent style={{width: "600px", height: "max-content"}}>
            <SingleSelect isLoading={this.state.isLoading} options={this.state.options} onChange={this.handleChange}/>
          </DialogContent>
          <DialogActions>
            <Button onClick={this.handleClose} color="primary">
              Cancel
            </Button>
            <Button onClick={this.handleSelect} color="primary">
              Select
            </Button>
          </DialogActions>
        </Dialog>
      </>
    );
  }
}
